<ion-header class="header" [translucent]="false">
  <ion-toolbar class="header-toolbar">
    <ion-title class="header-title">
      <span class="title-text">Nueva Tarjeta</span>
    </ion-title>
    <ion-progress-bar 
      *ngIf="isLoading===true" 
      color="warning" 
      type="indeterminate"
      class="progress-bar">
    </ion-progress-bar>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="main-content">
  <div class="principal">
    <!-- Formulario de creación -->
    <div class="form-container">
      <div class="form-section">
        <div class="field-group">
          <label class="field-label" for="nombreTarjeta">
            <ion-icon name="pricetag"></ion-icon>
            <span>Nombre de la tarjeta</span>
          </label>
          <div class="input-wrapper">
            <ion-input
              id="nombreTarjeta"
              [(ngModel)]="item.itemname"
              [counter]="true"
              maxlength="15"
              placeholder="Ej: Ahorros, Gastos, Inversión..."
              class="styled-input">
            </ion-input>
          </div>
        </div>

        <div class="field-group">
          <label class="field-label" for="icono">
            <ion-icon name="star"></ion-icon>
            <span>Selecciona un icono</span>
          </label>
          <div class="select-wrapper">
            <ion-select id="icono" [(ngModel)]="item.icono" placeholder="Elige un icono" class="styled-select">
              <ion-select-option *ngFor="let icon of listaIconos" [value]="icon">
                <ion-icon [name]="icon" slot="start"></ion-icon>
                {{ icon }}
              </ion-select-option>
            </ion-select>
          </div>
        </div>

        <div class="field-group">
          <label class="field-label">
            <ion-icon name="color-palette"></ion-icon>
            <span>Color de fondo</span>
          </label>
          <div class="color-section" [class.disabled]="tarjeta.nombreCSS!=='principal-dinamica'">
            <input 
              id="colorTarjeta" 
              type="color" 
              class="color-input" 
              [(ngModel)]="item.ColorFondo!" 
              [style.background]="getGradientColor()"
              [disabled]="tarjeta.nombreCSS!=='principal-dinamica'"/>
            <div class="color-display">
              <div class="color-circle" [style.background-color]="item.ColorFondo"></div>
              <span class="color-text">{{ item.ColorFondo || '#027abb' }}</span>
            </div>
          </div>
          <p class="field-hint" *ngIf="tarjeta.nombreCSS!=='principal-dinamica'">
            Primero selecciona una plantilla para personalizar el color
          </p>
        </div>
      </div>

      <div class="options-section">
        <h3 class="options-title">Opciones adicionales</h3>
        <p class="options-subtitle">Personaliza el comportamiento de tu tarjeta</p>

        <div class="option-card" [class.disabled]="tarjeta.nombreCSS!=='principal-dinamica'">
          <div class="option-content">
            <div class="option-info">
              <ion-icon name="text"></ion-icon>
              <div>
                <div class="option-name">Color de texto</div>
                <div class="option-description">Elige entre blanco o negro para el texto</div>
              </div>
            </div>
            <ion-toggle 
              id="colorLetra" 
              [(ngModel)]="colorletra" 
              (ionChange)="ColorDeLetra()" 
              [enableOnOffLabels]="true" 
              color="primary"
              [disabled]="tarjeta.nombreCSS!=='principal-dinamica'">
            </ion-toggle>
          </div>
        </div>

        <div class="option-card" [class.disabled]="tarjeta.nombreCSS!=='principal-dinamica'">
          <div class="option-content">
            <div class="option-info">
              <ion-icon name="time"></ion-icon>
              <div>
                <div class="option-name">Historial automático</div>
                <div class="option-description">Guarda el historial los días 1 y 15 de cada mes</div>
              </div>
            </div>
            <ion-toggle 
              id="Historial" 
              (ionChange)="EstadoHistorial()" 
              [enableOnOffLabels]="true" 
              color="primary"
              [disabled]="tarjeta.nombreCSS!=='principal-dinamica'">
            </ion-toggle>
          </div>
        </div>

        <div class="info-card" *ngIf="item.estadohistorial">
          <ion-icon name="information-circle"></ion-icon>
          <div>
            <strong>Historial automático activado</strong>
            <p>El historial de esta tarjeta se guardará automáticamente los días 1 y 15 de cada mes.</p>
          </div>
        </div>
      </div>

      <div class="button-container" id="Guarde">
        <ion-button 
          class="save-button" 
          expand="block" 
          (click)="Guardar()"
          [disabled]="isLoading || !item.itemname || !item.icono">
          <ion-icon name="checkmark-circle" slot="start"></ion-icon>
          Guardar Tarjeta
        </ion-button>
      </div>
    </div>

    <!-- Vista previa de la tarjeta -->
    <div class="preview-container">
      <div class="section-header">
        <ion-icon name="eye-outline" class="section-icon"></ion-icon>
        <h2 class="section-title">Vista Previa</h2>
      </div>
      <div class="tarjeta">
        <ion-card 
          id="Personalizacion" 
          [style.color]="item.colorLetra" 
          class="custom-card" 
          [ngClass]="tarjeta.nombreCSS">
          <div class="card-header">
            <ion-icon [style.color]="item.colorLetra" [name]="item.icono" class="chip-icon"></ion-icon>
            <span class="card-type">{{ item.itemname || 'Nombre' }}</span>
          </div>

          <div class="card-balance">Saldo: $00000</div>

          <div class="card-number">**** **** **** {{ idTarjeta.slice(-4) }}</div>

          <div class="card-footer">
            <div *ngIf="esCompartida" class="shared-info">
              <ion-icon name="people"></ion-icon>
              <span> 2 Compartidas</span>
              <span class="owner-name">Creada por: </span>
            </div>
            <span class="creation-date">{{ item.fecha || hoy }}</span>
          </div>

          <div class="softk-brand">SoftK</div>
        </ion-card>
      </div>
    </div>

    <!-- Tarjetas predeterminadas -->
    <div id="ListaOpciones" class="templates-container">
      <div class="section-header">
        <ion-icon name="albums-outline" class="section-icon"></ion-icon>
        <h2 class="section-title">Plantillas</h2>
      </div>
      <app-tarjetas-predeterminadas (Tselecionada)="RecibirTarjeta($event)"></app-tarjetas-predeterminadas>
    </div>
  </div>
</ion-content>
